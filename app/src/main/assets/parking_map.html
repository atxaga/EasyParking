<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zonas de parking - Donostia</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>

    <style>
        html, body { height: 100%; margin: 0; }
        #map { width: 100%; height: 100%; }
    </style>
</head>
<body>
<div id="map"></div>

<script>
    // Mapa centrado en Donostia
    var map = L.map('map').setView([43.3216, -1.9859], 14);

    // Capa base de OpenStreetMap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Consulta Overpass para parkings
    var query = `
      [out:json][timeout:25];
      area[name="Donostia-San Sebastián"]->.searchArea;
      (
        node["amenity"="parking"](area.searchArea);
        way["amenity"="parking"](area.searchArea);
        relation["amenity"="parking"](area.searchArea);
      );
      out center;
    `;

    fetch("https://overpass-api.de/api/interpreter", {
      method: "POST",
      body: query
    })
    .then(response => response.json())
    .then(data => {
      var heatPoints = [];

      data.elements.forEach(function (el) {
        if (el.type === "node") {
          heatPoints.push([el.lat, el.lon, 0.6]);
        } else if (el.center) {
          heatPoints.push([el.center.lat, el.center.lon, 0.6]);
        }
      });

      // Capa de calor (zonas con más parkings = más color)
      L.heatLayer(heatPoints, {
        radius: 25,
        blur: 15,
        maxZoom: 17,
        gradient: {
          0.2: "blue",
          0.4: "lime",
          0.6: "yellow",
          0.8: "orange",
          1.0: "red"
        }
      }).addTo(map);
    })
    .catch(err => console.error(err));
</script>
</body>
</html>
